use driveonly_db;

SET FOREIGN_KEY_CHECKS = 0;

DROP TABLE IF EXISTS member;
DROP TABLE IF EXISTS liked_course;
DROP TABLE IF EXISTS course;
DROP TABLE IF EXISTS category;
DROP TABLE IF EXISTS course_place;
DROP TABLE IF EXISTS place;
DROP TABLE IF EXISTS saved_place;
DROP TABLE IF EXISTS tag;
DROP TABLE IF EXISTS comment;
DROP TABLE IF EXISTS photo;

CREATE TABLE if not exists member (
    id BIGINT PRIMARY KEY auto_increment,
    email VARCHAR(100),
    nickname VARCHAR(60),
    profile_image_url VARCHAR(500),
    provider VARCHAR(20)
);

create table if not exists course (
    id BIGINT auto_increment,
    title varchar(250),
    created_date timestamp,
    recommendation double,
    difficulty double,
    view_count int,
    like_count int,
    comment_count int,
    is_reported boolean,
    member_id bigint,
    primary key (id),
    foreign key (member_id) references member(id)
);

CREATE TABLE if not exists liked_course (
    id BIGINT PRIMARY KEY auto_increment,
    member_id BIGINT,
    course_id BIGINT,
    FOREIGN KEY (member_id) REFERENCES member(id),
    FOREIGN KEY (course_id) REFERENCES course(id)
);

create table if not exists place
(
    id            bigint auto_increment,
    name          varchar(50),
    address       varchar(150),
    thumbnail_url varchar(500),
    use_time      varchar(100),
    rest_date     varchar(100),
    phone_num     varchar(20),
    lat           double,
    lng           double,
    primary key (id)
);

CREATE TABLE if not exists saved_place (
    id BIGINT PRIMARY KEY auto_increment,
    member_id BIGINT,
    place_id BIGINT,
    FOREIGN KEY (member_id) REFERENCES member(id),
    FOREIGN KEY (place_id) REFERENCES place(id)
);

create table if not exists course_place
(
    id         bigint auto_increment,
    name       varchar(100),
    place_type varchar(30),
    content    varchar(1500),
    sequence   int,
    course_id  bigint,
    place_id   bigint,
    member_id  bigint,
    primary key (id),
    foreign key (course_id) references course (id),
    foreign key (place_id) references place(id),
    foreign key (member_id) references member(id)
);

create table if not exists comment
(
    id           bigint auto_increment,
    content      varchar(255),
    created_date timestamp,
    like_count   int,
    member_id    bigint,
    course_id    bigint,
    parent_id    bigint,
    primary key (id),
    foreign key (member_id) references member(id),
    foreign key (course_id) references course(id),
    foreign key (parent_id) references comment(id)
);

CREATE TABLE if not exists category (
    id BIGINT PRIMARY KEY auto_increment,
    course_id BIGINT,
    region VARCHAR(30),
    sub_region VARCHAR(50),
    time VARCHAR(20),
    season VARCHAR(20),
    theme VARCHAR(20),
    area_type VARCHAR(20),
    FOREIGN KEY (course_id) REFERENCES course(id)
);

CREATE TABLE if not exists tag (
    id BIGINT PRIMARY KEY auto_increment,
    course_id BIGINT,
    tag VARCHAR(30),
    FOREIGN KEY (course_id) REFERENCES course(id)
);

CREATE TABLE if not exists photo (
   id BIGINT PRIMARY KEY auto_increment,
   course_place_id BIGINT,
   photo VARCHAR(500),
   FOREIGN KEY (course_place_id) REFERENCES course_place(id)
);

SET FOREIGN_KEY_CHECKS = 1;